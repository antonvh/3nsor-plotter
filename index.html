<!--
########################################################################                                                                 
# Program Name: Browser_Client_Coder.html                                     
# ================================     
# This code is for controlling a robot by a web browser using web sockets                            
#
########################################################################
-->
<!-- This code implements the web socket connection between client(web page on a Computer) and a server(raspberry pi) -->
<!-- It sends data from web page using buttons and Keyboard presses to control the BrickPi robot -->

<!DOCTYPE html>
<html>
<head>
  <title>WebSockets Client</title>
  <script src="http://code.jquery.com/jquery-1.9.1.min.js"></script>

</head>

<body>
</br></br>
</br>

<p>
  <!-- Creating press buttons  on the webpage-->
  <input id="lmf" type="button" value="Left motor fwd" onclick="lmf(); "/>
</p>

<p>
  <input id="lmb" type="button" value="Left motor back" onclick="lmb(); "/>
</p>

<p>
  <input id="stop" type="button" value="Stop" onclick="stop(); "/>
</p>

<p>
  <input id="rmf" type="button" value="Right motor fwd" onclick="rmf(); "/>
</p>

<p>
  <input id="rmb" type="button" value="Right motor back" onclick="rmb(); "/>
</p>

<p>
  <input id="zero" type="button" value="Zero" onclick="zero(); "/>
</p>

<p>
  <input id="plot" type="button" value="Plot" onclick="plot(); "/>
</p>

<p>
  <input id="plotc" type="button" value="Plot circles" onclick="plot_circles(); "/>
</p>


</br></br></br></br>

<!--<div id="send">-->
  <!--<p> Enter the hostname/ip address to make the websocket connection </p>-->
  <!--<input type="text" id="hostname" size="100"/><br>-->
  <!--<input id="clickMe" type="button" value="clickme" onclick="setup2()"/>-->
<!--</div>-->

</div>
<div id="output" style="height:300px">
  <p>No message from Brick Pi...</p>
</div>

<script>
var up;
var down;
var left;
var right;
var brakes;
var command;

function lmf()
{
	command = "lmf";
  setup2();        		// Goes to websocket connection function
}  

function rmb()
{
	command = "rmb";
	setup2();
}

function lmb()
{
	command = "lmb";
	setup2();
}

function rmf()
{
	command = "rmf";
	setup2();
}

function zero()
{
	command = "zero";
	setup2();
}

function plot()
{
	command = "plot";
	setup2();
}

function plot_circles()
{
	command = "plotcircles";
	setup2();
}

// defines a variable that stops the robot
function stop()       
{
	command = "stop";
	setup2();
}		 

// Creates the websockets connection 
function setup2()         
{
	var $hostname = $("#hostname");      			// assigns the data(hostname/ip address) entered in the text box
	var name = $hostname.val();          			// Variable name contains the string(hostname/ip address) entered in the text box
	if (!name)
	{
	  name = window.location.host
	} else
	{
	  name = name+":9093"
	}
	var host =  "ws://"+name+"/ws"; 	// combines the three string and creates a new string
	var socket = new WebSocket(host);

	// event handlers for websocket
	if(socket)
	{
		var count =1;
		socket.onopen = function()
		{
			count = 0;
			arrows();     // function for detecting keyboard presses
			buttons();    // function for detecting the button press on webpage
		}
		//Send the button pressed backed to the Raspberry Pi
		function buttons()
		{	
			socket.send(command);
		}

		function arrows()
		{
			document.onkeyup = KeyCheck;       
			function KeyCheck()
			{
				var KeyID = event.keyCode;
				switch(KeyID)
				{
				case 16: //shift key
				command = "stop";
				break; 
				case 17: //ctrl key
				command = "stop";
				break;
				case 37: //left arrow
				command = "lmb";
				break;
				case 38: //up arrow
				command = "rmf";
				break;
				case 39: //right arrow
				command = "lmf";
				break;
				case 40: //down arrow
				command = "rmb";
				break;
				case "o".charCodeAt():
				command = "zero";
				break;
				case "p".charCodeAt():
				command = "plot";
				break;
				default:
				command = "";
				}
				socket.send(command);
			}
		}
		socket.onmessage = function(msg)
		{
			showServerResponse(msg.data);
		}
		socket.onclose = function()
		{
			//alert("connection closed....");
			showServerResponse("The connection has been closed.");
		}
	}
	else
	{
		console.log("invalid socket");
	}
	function showServerResponse(txt)
	{
		var p = document.createElement('p');
		p.innerHTML = txt;
		document.getElementById('output').replaceChild(p);
	}	
}   


</script>
</body>
</html>
<script>   

jQuery(function($)
{
  if (!("WebSocket" in window)) 
  {
    alert("Your browser does not support web sockets");
  }
});


</script>